<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: SAR          (SAR ADC)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="IFXCYP_one-line.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__sar.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">SAR (SAR ADC)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>This driver configures and controls the SAR ADC subsystem block. </p>
<p>The functions and other declarations used in this driver are in cy_sar.h. You can include cy_pdl.h to get access to all functions and declarations in the PDL.</p>
<p>This SAR ADC subsystem is comprised of:</p><ul>
<li>a 12-bit SAR converter (SARADC)</li>
<li>an embedded reference block (SARREF)</li>
<li>a mux (<a class="el" href="group__group__sar.html#group_sar_sarmux">SARMUX</a>) at the inputs of the converter</li>
<li>a sequence controller (<a class="el" href="group__group__sar.html#group_sar_sarmux">SARSEQ</a>) that enables multi-channel acquisition in a round robin fashion, without CPU intervention, to maximize scan rates.</li>
</ul>
<div class="image">
<img src="sar_block_diagram.png" alt="sar_block_diagram.png"/>
</div>
<p>The high level features of the subsystem are:</p><ul>
<li>maximum sample rate of 1 Msps</li>
<li>sixteen individually configurable channels (depends on device routing capabilities)</li>
<li>per channel selectable<ul>
<li>single-ended or differential input mode</li>
<li>input from external pin (8 channels in single-ended mode or 4 channels in differential mode) or from internal signals (AMUXBUS, CTB)</li>
<li>choose one of four programmable acquisition times</li>
<li>averaging and accumulation</li>
</ul>
</li>
<li>scan can be triggered by firmware or hardware in single shot or continuous mode</li>
<li>hardware averaging from 2 to 256 samples</li>
<li>selectable voltage references<ul>
<li>internal VDDA and VDDA/2 references</li>
<li>buffered 1.2 V bandgap reference</li>
<li>external reference from dedicated pin</li>
</ul>
</li>
<li>interrupt generation</li>
</ul>
<h1><a class="anchor" id="group_sar_configuration"></a>
Configuration Considerations</h1>
<p>As an example, following SAR configuration will be used:</p><ul>
<li>Three channels:<ul>
<li>Single-ended channel on Pin 0</li>
<li>Single-ended channel on Pin 1</li>
<li>Differential channel between Pin 0 (positive input) and Pin 1 (negative input)</li>
</ul>
</li>
<li>12-bit resolution for all three channels</li>
<li>No sample averaging for all three channels</li>
<li>Trigger SAR from TCPWM-based timer.</li>
</ul>
<p>The high level steps to use SAR driver are:</p>
<ul>
<li><a class="el" href="group__group__sar.html#group_sar_config_structure">Configuration structure</a></li>
<li><a class="el" href="group__group__sar.html#group_sar_initialization">Initialization and Enable</a></li>
<li><a class="el" href="group__group__sar.html#group_sar_clock">SAR Clock Configuration</a></li>
<li><a class="el" href="group__group__sar.html#group_sar_trigger_conversions">Triggering Conversions</a></li>
<li><a class="el" href="group__group__sar.html#group_sar_handle_interrupts">Handling Interrupts</a></li>
<li><a class="el" href="group__group__sar.html#group_sar_retrieve_result">Retrieve Channel Results</a></li>
</ul>
<h1><a class="anchor" id="group_sar_config_structure"></a>
Configuration structure</h1>
<p>To configure the SAR subsystem, call <a class="el" href="group__group__sar__functions__basic.html#ga5c053a77ca29519ca29da56da7eaeebe">Cy_SAR_Init</a>. This function requires two pointers: a pointer to the <a class="el" href="struct_s_a_r___type.html">SAR_Type</a> structure for the base hardware register address and pointer to the configuration structure <a class="el" href="structcy__stc__sar__config__t.html">cy_stc_sar_config_t</a>.</p>
<p>Configuration structure <a class="el" href="structcy__stc__sar__config__t.html">cy_stc_sar_config_t</a> includes two substructures: <a class="el" href="structcy__stc__sar__config__t.html#ab62eaff49cde9d423d24d10d0b10b948">cy_stc_sar_config_t::channelConfig</a> and <a class="el" href="structcy__stc__sar__config__t.html#ad188c07382e6168af260b26d9aea5abc">cy_stc_sar_config_t::routingConfig</a>.</p>
<p><a class="el" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a> is used to configure individual channels. Here is an example of SAR channels configuration for our use case:</p>
<div class="fragment"><div class="line">    <a class="code" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a> channelSe0Cfg =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .addr          */</span> <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba4a26bfaac292bfec12b2b94f7ab9cefd">CY_SAR_ADDR_SARMUX_0</a>,             <span class="comment">/* Use Pin 0 of the SARMUX */</span></div><div class="line">        <span class="comment">/* .differential  */</span> <span class="keyword">false</span>,                            <span class="comment">/* Single ended */</span></div><div class="line">        <span class="comment">/* .resolution    */</span> CY_SAR_MAX_RES,                   <span class="comment">/* 12-bit */</span></div><div class="line">        <span class="comment">/* .avgEn         */</span> <span class="keyword">false</span>,                            <span class="comment">/* Disable averaging */</span></div><div class="line">        <span class="comment">/* .sampleTimeSel */</span> 0UL                               <span class="comment">/* Aperture time is set by Sample Time 0 */</span></div><div class="line">    };</div><div class="line"></div><div class="line">    <a class="code" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a> channelSe1Cfg =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .addr          */</span> <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba6604a9b591ff6f195fe738167a99a48c">CY_SAR_ADDR_SARMUX_1</a>,             <span class="comment">/* Use Pin 1 of the SARMUX */</span></div><div class="line">        <span class="comment">/* .differential  */</span> <span class="keyword">false</span>,                            <span class="comment">/* Single ended */</span></div><div class="line">        <span class="comment">/* .resolution    */</span> CY_SAR_MAX_RES,                   <span class="comment">/* 12-bit */</span></div><div class="line">        <span class="comment">/* .avgEn         */</span> <span class="keyword">false</span>,                            <span class="comment">/* Disable averaging */</span></div><div class="line">        <span class="comment">/* .sampleTimeSel */</span> 0UL                               <span class="comment">/* Aperture time is set by Sample Time 1 */</span></div><div class="line">    };</div><div class="line"></div><div class="line">    <a class="code" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a> channelDiffCfg =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .addr          */</span> <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba4a26bfaac292bfec12b2b94f7ab9cefd">CY_SAR_ADDR_SARMUX_0</a>,             <span class="comment">/* Positive terminal is connected to Pin 0 and negative terminal is connected to Pin 1 of the SARMUX */</span></div><div class="line">        <span class="comment">/* .differential  */</span> <span class="keyword">true</span>,                             <span class="comment">/* differential */</span></div><div class="line">        <span class="comment">/* .resolution    */</span> CY_SAR_MAX_RES,                   <span class="comment">/* 12-bit */</span></div><div class="line">        <span class="comment">/* .avgEn         */</span> <span class="keyword">false</span>,                            <span class="comment">/* Disable averaging */</span></div><div class="line">        <span class="comment">/* .sampleTimeSel */</span> 0UL                               <span class="comment">/* Aperture time is set by Sample Time 2 */</span></div><div class="line">    };</div></div><!-- fragment --><p> <a class="el" href="structcy__stc__sar__routing__config__t.html">cy_stc_sar_routing_config_t</a> is used to define SARMUX configuration. Use one or more values from the <a class="el" href="group__group__sar__mux__switch.html">SARMUX Switch Control Register Masks</a> and "OR" them together. Firmware control can be changed at run-time by calling <a class="el" href="group__group__sar__functions__switches.html#ga3249dd61b34ee21027c17d22b6eec820">Cy_SAR_SetAnalogSwitch</a> the desired switch states SARSEQ control can be changed at run-time by calling <a class="el" href="group__group__sar__functions__switches.html#gad3638875aaece8c84d939337c347df81">Cy_SAR_SetSwitchSarSeqCtrl</a>.</p>
<div class="fragment"><div class="line">    <a class="code" href="structcy__stc__sar__routing__config__t.html">cy_stc_sar_routing_config_t</a> routingConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .muxSwitch       */</span> <a class="code" href="group__group__sar__mux__switch.html#ga03ab1399a7ef0bdf790ae6ab56a50236">CY_SAR_MUX_FW_P0_VPLUS</a>    |     <span class="comment">/* Connect Pin 0 of the SARMUX to the positive terminal of the SARADC for the first single-ended channel */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#ga36d01b7dd5723e81cc7cda50ff423434">CY_SAR_MUX_FW_P1_VPLUS</a>    |     <span class="comment">/* Connect Pin 1 of the SARMUX to the positive terminal of the SARADC for the second single-ended channel */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#ga2f0367fcf4496d7565a31d8ace573378">CY_SAR_MUX_FW_P1_VMINUS</a>   |     <span class="comment">/* Connect Pin 1 of the SARMUX to the negative terminal of the SARADC for the differential channel */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#ga3298283312811f7b6f4c0e9eeccc289e">CY_SAR_MUX_FW_VSSA_VMINUS</a>,      <span class="comment">/* Connect VSSA of the SARMUX to the negative terminal of the SARADC for the single-ended channels */</span></div><div class="line">        <span class="comment">/* .muxSwitchHwCtrl */</span> <a class="code" href="group__group__sar__mux__switch.html#ga8f4ebeb2a706e1abf622c7851d9d4132">CY_SAR_MUX_HW_CTRL_P0</a>     |     <span class="comment">/* Enable sequencer control of Pins 0 of the SARMUX */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#gae452b37c2ef085a517455e20667123d3">CY_SAR_MUX_HW_CTRL_P1</a>     |     <span class="comment">/* Enable sequencer control of Pins 1 of the SARMUX */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#gade70cbf509d471b0bd0ffa98c436163f">CY_SAR_MUX_HW_CTRL_VSSA</a>         <span class="comment">/* Enable sequencer control of VSSA switch. */</span></div><div class="line">    };</div></div><!-- fragment --><p> In order to complete SAR configuration structure, all remaining fields of <a class="el" href="structcy__stc__sar__config__t.html">cy_stc_sar_config_t</a> should be filled:</p>
<div class="fragment"><div class="line">    <a class="code" href="structcy__stc__sar__config__t.html">cy_stc_sar_config_t</a> config =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .vrefSel            */</span> <a class="code" href="group__group__sar__enums.html#gga8f8244be5b3475b12564d27ce435dc83a609f8bdeee2cfce3f823f9dfec190900">CY_SAR_VREF_SEL_VDDA</a>,        <span class="comment">/* Select internal VDDA as the Vref */</span></div><div class="line">        <span class="comment">/* .vrefBypCapEn       */</span> <span class="keyword">true</span>,                        <span class="comment">/* Enable Vref bypass capacitor */</span></div><div class="line">        <span class="comment">/* .negSel             */</span> <a class="code" href="group__group__sar__enums.html#gga714456a56b0bed98012dc37256b1145ca24b7a5b85507d15f0cb04c55c2dc6436">CY_SAR_NEG_SEL_VSSA_KELVIN</a>,  <span class="comment">/* Use Vref as the negative terminal for all single-ended channels */</span></div><div class="line">        <span class="comment">/* .negVref            */</span> <a class="code" href="group__group__sar__enums.html#ggaed426a773be43a1d02d40fe5bef5349ca2fba6b968fa6def326ed7994bb299e80">CY_SAR_NEGVREF_HW</a>,           <span class="comment">/* Enable hardware control of switch between Vref and negative terminal */</span></div><div class="line">        <span class="comment">/* .boostPump          */</span> <span class="keyword">true</span>,                        <span class="comment">/* Enable boost pump */</span></div><div class="line">        <span class="comment">/* .power              */</span> <a class="code" href="group__group__sar__enums.html#ggac2a26813d7151c5f4be2ecd96b8b7e22ad4a4722c279eddf63d24e38cf6447673">CY_SAR_NORMAL_PWR</a>,           <span class="comment">/* Normal power level */</span></div><div class="line">        <span class="comment">/* .sarMuxDsEn         */</span> <span class="keyword">false</span>,                       <span class="comment">/* Disable SARMUX in Deep Sleep mode */</span></div><div class="line">        <span class="comment">/* .switchDisable      */</span> <span class="keyword">false</span>,                       <span class="comment">/* Enable the SARSEQ */</span></div><div class="line">        <span class="comment">/* .subResolution      */</span> CY_SAR_SUB_RESOLUTION_8B,    <span class="comment">/* Subresolution 8 bit - not used */</span></div><div class="line">        <span class="comment">/* .leftAlign          */</span> <span class="keyword">false</span>,                       <span class="comment">/* Right align result data to bits[11:0] */</span></div><div class="line">        <span class="comment">/* .singleEndedSigned  */</span> <span class="keyword">true</span>,                        <span class="comment">/* Single ended channels are signed */</span></div><div class="line">        <span class="comment">/* .differentialSigned */</span> <span class="keyword">true</span>,                        <span class="comment">/* Differential channels are signed */</span></div><div class="line">        <span class="comment">/* .avgCnt             */</span> <a class="code" href="group__group__sar__enums.html#ggaed912a3edfab12b4ebea94fedf289ecfa73a53b80105c99cdf5bb81cb4754612b">CY_SAR_AVG_CNT_2</a>,            <span class="comment">/* Set number of samples averaged to 2 - not used */</span></div><div class="line">        <span class="comment">/* .avgShift           */</span> <span class="keyword">true</span>,                        <span class="comment">/* Enable the averaged value right shifting - not used */</span></div><div class="line">        <span class="comment">/* .trigMode           */</span> <a class="code" href="group__group__sar__enums.html#gga62ecb4e368dcea23cfbfc41bd0497fc6a7eed8528ba801da55b7727c170d361e1">CY_SAR_TRIGGER_MODE_FW_AND_HWEDGE</a>, <span class="comment">/* Hardware trigger is enabled - will be used to trigger SAR by TCPWM */</span></div><div class="line">        <span class="comment">/* .eosEn              */</span> <span class="keyword">false</span>,                       <span class="comment">/* Hardware EOS trigger is disabled - not used */</span></div><div class="line">        <span class="comment">/* .sampleTime0        */</span> 4UL,                         <span class="comment">/* Sample Time 0 set to 4 ADC clock cycles */</span></div><div class="line">        <span class="comment">/* .sampleTime1        */</span> 4UL,                         <span class="comment">/* Sample Time 1 set to 4 ADC clock cycles - not used */</span></div><div class="line">        <span class="comment">/* .sampleTime2        */</span> 4UL,                         <span class="comment">/* Sample Time 2 set to 4 ADC clock cycles - not used */</span></div><div class="line">        <span class="comment">/* .sampleTime3        */</span> 4UL,                         <span class="comment">/* Sample Time 3 set to 4 ADC clock cycles - not used */</span></div><div class="line">        <span class="comment">/* .rangeThresLow      */</span> 0x300UL,                     <span class="comment">/* Lower limit of range detection is 0x300 - not used */</span></div><div class="line">        <span class="comment">/* .rangeThresHigh     */</span> 0xC00UL,                     <span class="comment">/* Upper limit of range detection is 0xC00 - not used */</span></div><div class="line">        <span class="comment">/* .rangeCond          */</span> <a class="code" href="group__group__sar__range__thres__register__enums.html#ggaccf649d65a86e17939c3d20a684cd9cda05ef1644deb92e634e163532a3b2179e">CY_SAR_RANGE_COND_OUTSIDE</a>,   <span class="comment">/* Set limit condition to outside of lower and upper limits - not used */</span></div><div class="line">        <span class="comment">/* .chanEn             */</span> 0x07UL,                      <span class="comment">/* Mask to enable channels 0, 1 and 2 (0b0111) */</span></div><div class="line">        <span class="comment">/* .channelConfig      */</span> {&amp;channelSe0Cfg, &amp;channelSe1Cfg, &amp;channelDiffCfg, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},</div><div class="line">        <span class="comment">/* .routingConfig      */</span> &amp;routingConfig,              <span class="comment">/* Pointer to the routing configuration structure */</span></div><div class="line">        <span class="comment">/* .vrefMvValue        */</span> 3300UL                       <span class="comment">/* Vdd is 3.3 V */</span></div><div class="line">    };</div></div><!-- fragment --> <h1><a class="anchor" id="group_sar_initialization"></a>
Initialization and Enable</h1>
<p>As mentioned in a previous step, to configure the SAR subsystem, call <a class="el" href="group__group__sar__functions__basic.html#ga5c053a77ca29519ca29da56da7eaeebe">Cy_SAR_Init</a> function with pointers to <a class="el" href="struct_s_a_r___type.html">SAR_Type</a> and <a class="el" href="structcy__stc__sar__config__t.html">cy_stc_sar_config_t</a> structures. After initialization, call <a class="el" href="group__group__sar__functions__basic.html#ga4b8bb939483fac5768910156075d4264">Cy_SAR_Enable</a> to enable the hardware.</p>
<div class="fragment"><div class="line">    <a class="code" href="group__group__sar__enums.html#ga4061024a91b0f2e3aca4716fce722b57">cy_en_sar_status_t</a> sarStatus = <a class="code" href="group__group__sar__functions__basic.html#ga5c053a77ca29519ca29da56da7eaeebe">Cy_SAR_Init</a>(SAR0, &amp;config);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__sar__enums.html#gga4061024a91b0f2e3aca4716fce722b57a1bcc04151b677cb6e16050b40309b21a">CY_SAR_SUCCESS</a> != sarStatus)</div><div class="line">    {</div><div class="line">        <span class="comment">/* insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__group__sar__functions__basic.html#ga4b8bb939483fac5768910156075d4264">Cy_SAR_Enable</a>(SAR0);</div></div><!-- fragment --> <h1><a class="anchor" id="group_sar_clock"></a>
SAR Clock Configuration</h1>
<p>The SAR requires a clock. Assign a clock to the SAR using the pre-defined enum, PCLK_PASS_CLOCK_SAR, to identify the SAR subsystem. Set the clock divider value to achieve the desired clock rate. The SAR can support a maximum frequency of 18 MHz.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Scenario: The SysClk has been configured to output 24 MHz.</span></div><div class="line"><span class="comment">     * Use one of the PeriClk dividers with a divider value of 12 to get a 2 Mhz SAR clock. */</span></div><div class="line"></div><div class="line">    <a class="code" href="group__group__sysclk__clk__peripheral__funcs.html#ga66c291e9903a5a499b516f600925b54b">Cy_SysClk_PeriphDisableDivider</a>(<a class="code" href="group__group__sysclk__clk__peripheral__enums.html#gga31d8e8225fff722b0246811da18f0c34a01bdb4658df44cefca91d4d86ffb2a53">CY_SYSCLK_DIV_16_BIT</a>, 2U); <span class="comment">/* Disable divider before configuring */</span></div><div class="line">    <a class="code" href="group__group__sysclk__clk__peripheral__funcs.html#ga548bab5bed961e0f210892299baa389d">Cy_SysClk_PeriphSetDivider</a>(<a class="code" href="group__group__sysclk__clk__peripheral__enums.html#gga31d8e8225fff722b0246811da18f0c34a01bdb4658df44cefca91d4d86ffb2a53">CY_SYSCLK_DIV_16_BIT</a>, 2U, 11U); <span class="comment">/* Set divider 12 resulting 2MHz */</span></div><div class="line">    <a class="code" href="group__group__sysclk__clk__peripheral__funcs.html#gafec3a5a368f67cae80adfd61a9550cb4">Cy_SysClk_PeriphEnableDivider</a>(<a class="code" href="group__group__sysclk__clk__peripheral__enums.html#gga31d8e8225fff722b0246811da18f0c34a01bdb4658df44cefca91d4d86ffb2a53">CY_SYSCLK_DIV_16_BIT</a>, 2U); <span class="comment">/* Enable the divider */</span></div><div class="line">    <a class="code" href="group__group__sysclk__clk__peripheral__funcs.html#ga735e08e163703408d76adac860b752c8">Cy_SysClk_PeriphAssignDivider</a>(PCLK_PASS0_CLOCK_SAR, <a class="code" href="group__group__sysclk__clk__peripheral__enums.html#gga31d8e8225fff722b0246811da18f0c34a01bdb4658df44cefca91d4d86ffb2a53">CY_SYSCLK_DIV_16_BIT</a>, 2U); <span class="comment">/* Assign divider to the SAR0 */</span></div></div><!-- fragment --> <h1><a class="anchor" id="group_sar_trigger_conversions"></a>
Triggering Conversions</h1>
<p>The SAR subsystem has the following modes for triggering a conversion: </p><table class="doxtable">
<tr>
<th>Mode </th><th>Description </th><th>Usage  </th></tr>
<tr>
<td>Continuous </td><td>After completing a scan, the SARSEQ will immediately start the next scan. That is, the SARSEQ will always be BUSY. As a result all other triggers, firmware or hardware, are essentially ignored.  </td><td>To enter this mode, call <a class="el" href="group__group__sar__functions__basic.html#ga92cb7f3c5947df6e47b59f1b2796883c">Cy_SAR_StartConvert</a> with <a class="el" href="group__group__sar__enums.html#ggaf21d08e4f15f54ac638943e50538d95caf9d6d2d190b4a044611be54dbe147890">CY_SAR_START_CONVERT_CONTINUOUS</a>. To stop continuous conversions, call <a class="el" href="group__group__sar__functions__basic.html#ga1397031ccf2c1f8a5a95a77f9362e1d1">Cy_SAR_StopConvert</a>.   </td></tr>
<tr>
<td>Firmware single shot </td><td>A single conversion of all enabled channels is triggered with a function call to <a class="el" href="group__group__sar__functions__basic.html#ga92cb7f3c5947df6e47b59f1b2796883c">Cy_SAR_StartConvert</a> with <a class="el" href="group__group__sar__enums.html#ggaf21d08e4f15f54ac638943e50538d95ca2aae9e550dc6dd379d8a37d28445dbbf">CY_SAR_START_CONVERT_SINGLE_SHOT</a>.  </td><td>Firmware triggering is always available by calling <a class="el" href="group__group__sar__functions__basic.html#ga92cb7f3c5947df6e47b59f1b2796883c">Cy_SAR_StartConvert</a> with <a class="el" href="group__group__sar__enums.html#ggaf21d08e4f15f54ac638943e50538d95ca2aae9e550dc6dd379d8a37d28445dbbf">CY_SAR_START_CONVERT_SINGLE_SHOT</a>. To allow only firmware triggering, or disable hardware triggering, set up the <a class="el" href="structcy__stc__sar__config__t.html#ab31d2eaf109a1e7d0a0def0d28af8663">cy_stc_sar_config_t::trigMode</a> field of config structure with <a class="el" href="group__group__sar__enums.html#gga62ecb4e368dcea23cfbfc41bd0497fc6a55a26ca93dcfd68c8b9b120416bc1b32">CY_SAR_TRIGGER_MODE_FW_ONLY</a>.   </td></tr>
<tr>
<td>Hardware edge sensitive </td><td>A single conversion of all enabled channels is triggered on the rising edge of the hardware trigger signal. </td><td>To enable this mode, set up the <a class="el" href="structcy__stc__sar__config__t.html#ab31d2eaf109a1e7d0a0def0d28af8663">cy_stc_sar_config_t::trigMode</a> field of config structure with <a class="el" href="group__group__sar__enums.html#gga62ecb4e368dcea23cfbfc41bd0497fc6a7eed8528ba801da55b7727c170d361e1">CY_SAR_TRIGGER_MODE_FW_AND_HWEDGE</a>.  </td></tr>
<tr>
<td>Hardware level sensitive </td><td>Conversions are triggered continuously when the hardware trigger signal is high. </td><td>To enable this mode, set up the <a class="el" href="structcy__stc__sar__config__t.html#ab31d2eaf109a1e7d0a0def0d28af8663">cy_stc_sar_config_t::trigMode</a> field of config structure with <a class="el" href="group__group__sar__enums.html#gga62ecb4e368dcea23cfbfc41bd0497fc6ac7d137ec50152f166656503877638943">CY_SAR_TRIGGER_MODE_FW_AND_HWLEVEL</a>.  </td></tr>
</table>
<p>The trigger mode can be changed during run time with <a class="el" href="group__group__sar__functions__config.html#gaabd68168933e0922c739ee8ebe3cddd6">Cy_SAR_SetConvertMode</a>.</p>
<p>For the hardware trigger modes, use the <a class="el" href="group__group__trigmux.html">TrigMux (Trigger Multiplexer)</a> driver to route an internal or external signal to the SAR trigger input. When making the required <a class="el" href="group__group__trigmux__functions.html#ga9a10a91df7c51ba3b61fdedbcc2d0cfe">Cy_TrigMux_Connect</a> calls, use the pre-defined enum, TRIG6_OUT_PASS_TR_SAR_IN, for the SAR trigger input.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Scenario: TCPWM is used to trigger the SAR conversions.</span></div><div class="line"><span class="comment">     * Connect the TCPWM to the SAR trigger input.</span></div><div class="line"><span class="comment">     */</span></div><div class="line"><span class="preprocessor">    #if (defined(CY_DEVICE_PSOC4AS3) || defined(CY_DEVICE_PSOC4AS4) || defined(CY_DEVICE_PSOC4AMC))</span></div><div class="line">        <a class="code" href="group__group__trigmux__enums.html#ga30a0d3f7caf6a59d3fb7a618a95ed6ae">cy_en_trigmux_status_t</a> trigmuxStatus = <a class="code" href="group__group__trigmux__functions.html#ga9a10a91df7c51ba3b61fdedbcc2d0cfe">Cy_TrigMux_Connect</a>(TRIG2_IN_TCPWM_TR_COMPARE_MATCH2, TRIG2_OUT_PASS0_TR_SAR_IN);</div><div class="line"><span class="preprocessor">    #else </span><span class="comment">/* other device family */</span><span class="preprocessor"></span></div><div class="line">        <a class="code" href="group__group__trigmux__enums.html#ga30a0d3f7caf6a59d3fb7a618a95ed6ae">cy_en_trigmux_status_t</a> trigmuxStatus = <a class="code" href="group__group__trigmux__functions.html#ga9a10a91df7c51ba3b61fdedbcc2d0cfe">Cy_TrigMux_Connect</a>(TRIG1_IN_TCPWM_TR_COMPARE_MATCH2, TRIG1_OUT_PASS0_TR_SAR_IN);</div><div class="line"><span class="preprocessor">    #endif </span><span class="comment">/* PSoC4 device family */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__trigmux__enums.html#gga30a0d3f7caf6a59d3fb7a618a95ed6aea19e80892aa7755dd38c708994502d02c">CY_TRIGMUX_SUCCESS</a> != trigmuxStatus)</div><div class="line">    {</div><div class="line">        <span class="comment">/* insert error handling here */</span></div><div class="line">    }</div></div><!-- fragment --> <h1><a class="anchor" id="group_sar_handle_interrupts"></a>
Handling Interrupts</h1>
<p>The SAR can generate interrupts on these events:</p>
<ul>
<li>End of scan (EOS): when scanning of all enabled channels complete.</li>
<li>Overflow: when the result register is updated before the previous result is read.</li>
<li>FW collision: when a new trigger is received while the SAR is still processing the previous trigger.</li>
<li>Saturation detection: when the channel result is equal to the minimum or maximum value.</li>
<li>Range detection: when the channel result meets the programmed upper or lower threshold values.</li>
</ul>
<p>The SAR interrupt to the NVIC is raised any time the intersection (logic and) of the interrupt flags and the corresponding interrupt masks are non-zero.</p>
<p>Implement an interrupt routine and assign it to the SAR interrupt. Use the pre-defined enum, pass_interrupt_sar_IRQn, as the interrupt source for the SAR.</p>
<p>The following code snippet demonstrates how to implement a routine to handle the interrupt. The routine gets called when any one of the SAR interrupts are triggered. When servicing an interrupt, the user must clear the interrupt so that subsequent interrupts can be handled.</p>
<div class="fragment"><div class="line">    int16_t adcResult[3] = {0, 0, 0}; <span class="comment">/* Results storage */</span></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> SAR0_Isr(<span class="keywordtype">void</span>)</div><div class="line">    {</div><div class="line">        uint32_t intrMask = <a class="code" href="group__group__sar__functions__interrupt.html#gaddf21063ab5d851b7a658af1c3c07f65">Cy_SAR_GetInterruptStatus</a>(SAR0);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (0UL != (<a class="code" href="group__group__sar__macros__interrupt.html#ga9538a57901b8fab401b60e71834d3971">CY_SAR_INTR_EOS</a> &amp; intrMask))</div><div class="line">        {</div><div class="line">            adcResult[0] = <a class="code" href="group__group__sar__functions__basic.html#ga5d7a3489629382b1e46477c034bbb2d0">Cy_SAR_GetResult16</a>(SAR0, 0);</div><div class="line">            adcResult[1] = <a class="code" href="group__group__sar__functions__basic.html#ga5d7a3489629382b1e46477c034bbb2d0">Cy_SAR_GetResult16</a>(SAR0, 1);</div><div class="line">            adcResult[2] = <a class="code" href="group__group__sar__functions__basic.html#ga5d7a3489629382b1e46477c034bbb2d0">Cy_SAR_GetResult16</a>(SAR0, 2);</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__group__sar__functions__interrupt.html#ga749c0d8406080c3a2fc0d6f6d86fc06e">Cy_SAR_ClearInterrupt</a>(SAR0, intrMask);</div><div class="line">    }</div></div><!-- fragment --><p> The following code snippet demonstrates how to configure and enable the interrupt.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Scenario: Configure and enable the SAR interrupt. */</span></div><div class="line">    <a class="code" href="structcy__stc__sysint__t.html">cy_stc_sysint_t</a> SAR0_IrqConfig =</div><div class="line">    {</div><div class="line">            <span class="comment">/* .intrSrc         = */</span> pass_0_interrupt_sar_IRQn,   <span class="comment">/* Interrupt source is the SAR interrupt */</span></div><div class="line">            <span class="comment">/* .intrPriority    = */</span> 3UL                        <span class="comment">/* Interrupt priority is 7 */</span></div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">/* Configure the interrupt with vector at SAR0_Isr(). */</span></div><div class="line">    <a class="code" href="group__group__sysint__enums.html#ga01619b224f9d5c23915e51783ea184c8">cy_en_sysint_status_t</a> sysintStatus = <a class="code" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init</a>(&amp;SAR0_IrqConfig, SAR0_Isr);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__sysint__enums.html#gga01619b224f9d5c23915e51783ea184c8af7db469e7f8cd5cb7917d1324005eb89">CY_SYSINT_SUCCESS</a> != sysintStatus)</div><div class="line">    {</div><div class="line">        <span class="comment">/* insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Enable the interrupt. */</span></div><div class="line">    NVIC_EnableIRQ(SAR0_IrqConfig.<a class="code" href="structcy__stc__sysint__t.html#a6da08d81da65a7f93d3e4c46a4b8d950">intrSrc</a>);</div><div class="line">    </div><div class="line">    <span class="comment">/* Clear possible interrupt erroneously raised during block enabling */</span></div><div class="line">    <a class="code" href="group__group__sar__functions__interrupt.html#ga749c0d8406080c3a2fc0d6f6d86fc06e">Cy_SAR_ClearInterrupt</a>(SAR0, <a class="code" href="group__group__sar__macros__interrupt.html#ga471233cf915dda88b9d6b1a272d26ee2">CY_SAR_INTR</a>);</div><div class="line">    <a class="code" href="group__group__sar__functions__interrupt.html#ga0e58407ba299f3cdd3170133bdffb0ba">Cy_SAR_SetInterruptMask</a>(SAR0, <a class="code" href="group__group__sar__macros__interrupt.html#ga9538a57901b8fab401b60e71834d3971">CY_SAR_INTR_EOS</a>);</div></div><!-- fragment --><p> Alternately, instead of handling the interrupts, the <a class="el" href="group__group__sar__functions__basic.html#ga977c6fb6f81ee39d27eae43c0e45d85c">Cy_SAR_IsEndConversion</a> function allows for firmware polling of the end of conversion status.</p>
<h1><a class="anchor" id="group_sar_retrieve_result"></a>
Retrieve Channel Results</h1>
<p>Retrieve the ADC result by calling <a class="el" href="group__group__sar__functions__basic.html#ga5d7a3489629382b1e46477c034bbb2d0">Cy_SAR_GetResult16</a> with the desired channel. To convert the result to a voltage, pass the ADC result to <a class="el" href="group__group__sar__functions__countsto.html#gaf9e34e8b68020602396686ec699314a1">Cy_SAR_CountsTo_Volts</a>, <a class="el" href="group__group__sar__functions__countsto.html#ga8f1189056459a76c4b9f9917dc3a9e6e">Cy_SAR_CountsTo_mVolts</a>, or <a class="el" href="group__group__sar__functions__countsto.html#ga0950546e50604fc6daa33b2bdb155e5d">Cy_SAR_CountsTo_uVolts</a>. To customize the counts-to-volts conversion process, use <a class="el" href="group__group__sar__functions__countsto.html#gaf8617e3aa90b4069b0b6605802a3ac08">Cy_SAR_SetChannelOffset</a> and <a class="el" href="group__group__sar__functions__countsto.html#ga39cd1ae1f2f7101812199b012f22b635">Cy_SAR_SetChannelGain</a> functions.</p>
<h1><a class="anchor" id="group_sar_scan_time"></a>
Scan Rate</h1>
<p>The scan rate is dependent on the following:</p>
<ul>
<li>ADC clock rate</li>
<li>Number of channels</li>
<li>Averaging</li>
<li>Resolution</li>
<li>Acquisition times</li>
</ul>
<h2><a class="anchor" id="group_sar_acquisition_time"></a>
Acquisition Time</h2>
<p>The acquisition time of a channel is based on which of the four global aperture times are selected for that channel. The selection is done during initialization per channel with <a class="el" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a>. The four global aperture times are also set during initialization with from <a class="el" href="structcy__stc__sar__config__t.html#adb696990f7ea3f459281d41dc9a334f8">cy_stc_sar_config_t::sampleTime0</a> through <a class="el" href="structcy__stc__sar__config__t.html#a528db897c99b047e7deab581569a489a">cy_stc_sar_config_t::sampleTime3</a>. Note that these global aperture times are in SAR clock cycles and the acquisition time is 1 less than that value in the register.</p>
<div class="image">
<img src="sar_acquisition_time_eqn.png" alt="sar_acquisition_time_eqn.png"/>
</div>
<h2><a class="anchor" id="group_sar_channel_sample_time"></a>
Channel Sample Time</h2>
<p>The sample time for a channel is the time required to acquire the analog signal and convert it to a digital code.</p>
<div class="image">
<img src="sar_channel_sample_time_eqn.png" alt="sar_channel_sample_time_eqn.png"/>
</div>
<p>The SAR ADC is a 12-bit converter so Resolution = 12.</p>
<h2><a class="anchor" id="group_sar_total_scan_time"></a>
Total Scan Time</h2>
<p>Channels using one of the sequential averaging modes (CY_SAR_AVG_MODE_SEQUENTIAL_ACCUM or CY_SAR_AVG_MODE_SEQUENTIAL_FIXED) are sampled multiple times per scan. The number of samples averaged are set during initialization with group_sar_init_struct_sampleCtrl using one of the values from cy_en_sar_sample_ctrl_avg_cnt_t. Channels that are not averaged are only sampled once per scan.</p>
<p>The total scan time is the sum of each channel's sample time multiplied by the samples per scan.</p>
<div class="image">
<img src="sar_scan_rate_eqn.png" alt="sar_scan_rate_eqn.png"/>
</div>
<p>where N is the total number of channels in the scan.</p>
<h1><a class="anchor" id="group_sar_sarmux"></a>
SARMUX and SARSEQ</h1>
<p>The SARMUX is an analog programmable multiplexer. Its switches can be controlled by the SARSEQ or firmware. and the inputs can come from:</p><ul>
<li>a dedicated port (can support 8 single-ended channels or 4 differential channels)</li>
<li>an internal die temperature (DieTemp) sensor</li>
<li>CTB output via SARBUS0/1 (if CTBs are available on the device)</li>
<li>AMUXBUSA/B</li>
</ul>
<p>The following figure shows the SARMUX switches. See the device datasheet for the exact location of SARMUX pins.</p>
<div class="image">
<img src="sar_sarmux_switches.png" alt="sar_sarmux_switches.png"/>
</div>
<p>When using the SARSEQ, the following configurations must be performed:</p><ul>
<li>enable SARSEQ control of required switches ( <a class="el" href="structcy__stc__sar__routing__config__t.html#ab5b111c24489c3f1ad0a7b1d576754f2">cy_stc_sar_routing_config_t::muxSwitchHwCtrl</a>)</li>
<li>close the required switches with firmware ( <a class="el" href="structcy__stc__sar__routing__config__t.html#a91171c914047613e455ba37c81fe0d43">cy_stc_sar_routing_config_t::muxSwitch</a>)</li>
<li>configure the PORT_ADDR and PIN_ADDR</li>
</ul>
<p>While firmware can control every switch in the SARMUX, not every switch can be controlled by the SARSEQ (green switches in the above figure). Additionally, switches outside of the SARMUX such as the AMUXBUSA/B switches or CTB switches will require separate function calls (see <a class="el" href="group__group__gpio.html">GPIO</a> and CTB drivers). The SARSEQ can control three switches in the CTB driver. These switches need to be enabled for SARSEQ control if the CTB outputs are used as the SARMUX inputs.</p>
<h2><a class="anchor" id="group_sar_sarmux_se_diff"></a>
Input from SARMUX port</h2>
<p>The following figure and code snippet show how two GPIOs on the SARMUX dedicated port are connected to the SARADC as separate single-ended channels and as a differential-pair channel.</p>
<div class="image">
<img src="sar_sarmux_dedicated_port.png" alt="sar_sarmux_dedicated_port.png"/>
</div>
<div class="fragment"><div class="line">    <a class="code" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a> channelSe0Cfg =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .addr          */</span> <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba4a26bfaac292bfec12b2b94f7ab9cefd">CY_SAR_ADDR_SARMUX_0</a>,             <span class="comment">/* Use Pin 0 of the SARMUX */</span></div><div class="line">        <span class="comment">/* .differential  */</span> <span class="keyword">false</span>,                            <span class="comment">/* Single ended */</span></div><div class="line">        <span class="comment">/* .resolution    */</span> CY_SAR_MAX_RES,                   <span class="comment">/* 12-bit */</span></div><div class="line">        <span class="comment">/* .avgEn         */</span> <span class="keyword">false</span>,                            <span class="comment">/* Disable averaging */</span></div><div class="line">        <span class="comment">/* .sampleTimeSel */</span> 0UL                               <span class="comment">/* Aperture time is set by Sample Time 0 */</span></div><div class="line">    };</div><div class="line"></div><div class="line">    <a class="code" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a> channelSe1Cfg =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .addr          */</span> <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba6604a9b591ff6f195fe738167a99a48c">CY_SAR_ADDR_SARMUX_1</a>,             <span class="comment">/* Use Pin 1 of the SARMUX */</span></div><div class="line">        <span class="comment">/* .differential  */</span> <span class="keyword">false</span>,                            <span class="comment">/* Single ended */</span></div><div class="line">        <span class="comment">/* .resolution    */</span> CY_SAR_MAX_RES,                   <span class="comment">/* 12-bit */</span></div><div class="line">        <span class="comment">/* .avgEn         */</span> <span class="keyword">false</span>,                            <span class="comment">/* Disable averaging */</span></div><div class="line">        <span class="comment">/* .sampleTimeSel */</span> 0UL                               <span class="comment">/* Aperture time is set by Sample Time 1 */</span></div><div class="line">    };</div><div class="line"></div><div class="line">    <a class="code" href="structcy__stc__sar__channel__config__t.html">cy_stc_sar_channel_config_t</a> channelDiffCfg =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .addr          */</span> <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba4a26bfaac292bfec12b2b94f7ab9cefd">CY_SAR_ADDR_SARMUX_0</a>,             <span class="comment">/* Positive terminal is connected to Pin 0 and negative terminal is connected to Pin 1 of the SARMUX */</span></div><div class="line">        <span class="comment">/* .differential  */</span> <span class="keyword">true</span>,                             <span class="comment">/* differential */</span></div><div class="line">        <span class="comment">/* .resolution    */</span> CY_SAR_MAX_RES,                   <span class="comment">/* 12-bit */</span></div><div class="line">        <span class="comment">/* .avgEn         */</span> <span class="keyword">false</span>,                            <span class="comment">/* Disable averaging */</span></div><div class="line">        <span class="comment">/* .sampleTimeSel */</span> 0UL                               <span class="comment">/* Aperture time is set by Sample Time 2 */</span></div><div class="line">    };</div></div><!-- fragment --><div class="fragment"><div class="line">    <a class="code" href="structcy__stc__sar__routing__config__t.html">cy_stc_sar_routing_config_t</a> routingConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .muxSwitch       */</span> <a class="code" href="group__group__sar__mux__switch.html#ga03ab1399a7ef0bdf790ae6ab56a50236">CY_SAR_MUX_FW_P0_VPLUS</a>    |     <span class="comment">/* Connect Pin 0 of the SARMUX to the positive terminal of the SARADC for the first single-ended channel */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#ga36d01b7dd5723e81cc7cda50ff423434">CY_SAR_MUX_FW_P1_VPLUS</a>    |     <span class="comment">/* Connect Pin 1 of the SARMUX to the positive terminal of the SARADC for the second single-ended channel */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#ga2f0367fcf4496d7565a31d8ace573378">CY_SAR_MUX_FW_P1_VMINUS</a>   |     <span class="comment">/* Connect Pin 1 of the SARMUX to the negative terminal of the SARADC for the differential channel */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#ga3298283312811f7b6f4c0e9eeccc289e">CY_SAR_MUX_FW_VSSA_VMINUS</a>,      <span class="comment">/* Connect VSSA of the SARMUX to the negative terminal of the SARADC for the single-ended channels */</span></div><div class="line">        <span class="comment">/* .muxSwitchHwCtrl */</span> <a class="code" href="group__group__sar__mux__switch.html#ga8f4ebeb2a706e1abf622c7851d9d4132">CY_SAR_MUX_HW_CTRL_P0</a>     |     <span class="comment">/* Enable sequencer control of Pins 0 of the SARMUX */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#gae452b37c2ef085a517455e20667123d3">CY_SAR_MUX_HW_CTRL_P1</a>     |     <span class="comment">/* Enable sequencer control of Pins 1 of the SARMUX */</span></div><div class="line">                               <a class="code" href="group__group__sar__mux__switch.html#gade70cbf509d471b0bd0ffa98c436163f">CY_SAR_MUX_HW_CTRL_VSSA</a>         <span class="comment">/* Enable sequencer control of VSSA switch. */</span></div><div class="line">    };</div></div><!-- fragment --> <h2><a class="anchor" id="group_sar_sarmux_ctb"></a>
Input from CTB output visa SARBUS0/1</h2>
<p>The following figure and code snippet show how the two opamp outputs from the CTB are connected to the SARADC as separate single-ended channels and as a differential-pair channel. Note that separate function calls are needed to configure and enable the opamps, perform required analog routing, and enable SARSEQ control of the switches contained in the CTB.</p>
<div class="image">
<img src="sar_sarmux_ctb.png" alt="sar_sarmux_ctb.png"/>
</div>
<p>Use <a class="el" href="group__group__sar.html#group_sar_sarmux_se_diff">Input from SARMUX port</a> code snippet for reference.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Check the device TRM for the CTB block presence */</span></div><div class="line"></div><div class="line">    channelSe0Cfg.<a class="code" href="structcy__stc__sar__channel__config__t.html#a88b297659ac0f5232102ec8b04eee323">addr</a> = <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba765400a183955e7922de53bc4cff9eb8">CY_SAR_ADDR_CTB0_OA0</a>;  <span class="comment">/* Use CTB0 OA0 out */</span></div><div class="line">    channelSe1Cfg.<a class="code" href="structcy__stc__sar__channel__config__t.html#a88b297659ac0f5232102ec8b04eee323">addr</a> = <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba9f3fb03759ae1ce6816ba8ec9906af6c">CY_SAR_ADDR_CTB0_OA1</a>;  <span class="comment">/* Use CTB0 OA1 out */</span></div><div class="line">    channelDiffCfg.<a class="code" href="structcy__stc__sar__channel__config__t.html#a88b297659ac0f5232102ec8b04eee323">addr</a> = <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba765400a183955e7922de53bc4cff9eb8">CY_SAR_ADDR_CTB0_OA0</a>; <span class="comment">/* Use CTB0 OA0 for Vplus and CTB0 OA0 for Vminus */</span></div><div class="line"></div><div class="line">    routingConfig.<a class="code" href="structcy__stc__sar__routing__config__t.html#a91171c914047613e455ba37c81fe0d43">muxSwitch</a> =       <a class="code" href="group__group__sar__mux__switch.html#ga0ebe8befe16a970375185e279914065f">CY_SAR_MUX_FW_SARBUS0_VPLUS</a>  |  <span class="comment">/* Close switch between Vplus and SARBUS0 for Channels 0, 1, and 2. */</span></div><div class="line">                                    <a class="code" href="group__group__sar__mux__switch.html#ga40f47a6ec9da51e613e2e94a8d35fdc1">CY_SAR_MUX_FW_SARBUS1_VMINUS</a> |  <span class="comment">/* Close switch between Vminus and SARBUS1 for Channel 2. */</span></div><div class="line">                                    <a class="code" href="group__group__sar__mux__switch.html#ga3298283312811f7b6f4c0e9eeccc289e">CY_SAR_MUX_FW_VSSA_VMINUS</a>;      <span class="comment">/* Close switch between Vminus and VSSA for single-ended Channel 0. */</span></div><div class="line">    routingConfig.<a class="code" href="structcy__stc__sar__routing__config__t.html#ab5b111c24489c3f1ad0a7b1d576754f2">muxSwitchHwCtrl</a> = <a class="code" href="group__group__sar__mux__switch.html#ga486182723c4908d89773e10f8bade487">CY_SAR_MUX_HW_CTRL_SARBUS0</a>   |  <span class="comment">/* Enable SARSEQ control of SARBUS0 switch. */</span></div><div class="line">                                    <a class="code" href="group__group__sar__mux__switch.html#ga35d6dca5511face97c637abfcd72cfb5">CY_SAR_MUX_HW_CTRL_SARBUS1</a>   |  <span class="comment">/* Enable SARSEQ control of SARBUS1 switch. */</span></div><div class="line">                                    <a class="code" href="group__group__sar__mux__switch.html#gade70cbf509d471b0bd0ffa98c436163f">CY_SAR_MUX_HW_CTRL_VSSA</a>;        <span class="comment">/* Enable SARSEQ control of VSSA switch. */</span></div></div><!-- fragment --> <h2><a class="anchor" id="group_sar_sarmux_amuxbus"></a>
Input from other pins through AMUXBUSA/B</h2>
<p>The following figure and code snippet show how two GPIOs on any port through the AMUXBUSA and AMUXBUSB are connected to the SARADC as separate single-ended channels and as a differential-pair channel. Note that separate function calls are needed to route the device pins to the SARMUX. The AMUXBUSes are separated into multiple segments and these segments are connected/disconnected using the AMUX_SPLIT_CTL registers in the HSIOM.</p>
<div class="image">
<img src="sar_sarmux_amuxbus.png" alt="sar_sarmux_amuxbus.png"/>
</div>
<p>Use <a class="el" href="group__group__sar.html#group_sar_sarmux_se_diff">Input from SARMUX port</a> code snippet for reference.</p>
<div class="fragment"><div class="line">    channelSe0Cfg.<a class="code" href="structcy__stc__sar__channel__config__t.html#a88b297659ac0f5232102ec8b04eee323">addr</a> = <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba8e5f2a4f81d2961325d46cbccabf1b6a">CY_SAR_ADDR_SARMUX_AMUXBUS_A</a>;     <span class="comment">/* Use Pin 0 of the SARMUX */</span></div><div class="line">    channelSe1Cfg.<a class="code" href="structcy__stc__sar__channel__config__t.html#a88b297659ac0f5232102ec8b04eee323">addr</a> = <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2bafd28f9b7d3c1c6c37e27ac108e6026b1">CY_SAR_ADDR_SARMUX_AMUXBUS_B</a>;  </div><div class="line">    channelDiffCfg.<a class="code" href="structcy__stc__sar__channel__config__t.html#a88b297659ac0f5232102ec8b04eee323">addr</a> = <a class="code" href="group__group__sar__chan__config__register__enums.html#gga46276a7af3b10d2f3959f5ab94bb5c2ba8e5f2a4f81d2961325d46cbccabf1b6a">CY_SAR_ADDR_SARMUX_AMUXBUS_A</a>; </div><div class="line"></div><div class="line">    <span class="comment">/* Configure pins */</span></div><div class="line">    <a class="code" href="group__group__gpio__functions__init.html#gab9eb13a6056e4c824514d59ce66017b5">Cy_GPIO_SetHSIOM</a>(GPIO_PRT1, 0UL, P1_0_AMUXA);    <span class="comment">/* Connect P1_0 to AMUXBUSA. */</span></div><div class="line">    <a class="code" href="group__group__gpio__functions__init.html#gab9eb13a6056e4c824514d59ce66017b5">Cy_GPIO_SetHSIOM</a>(GPIO_PRT1, 1UL, P1_1_AMUXB);    <span class="comment">/* Connect P1_1 to AMUXBUSB. */</span></div><div class="line">    </div><div class="line">    <span class="comment">/* Set drive mode of P1_0 and P1_1 to analog high-z. */</span></div><div class="line">    <a class="code" href="group__group__gpio__functions__gpio.html#ga97e64dc8c45e7cd73e3012100d03b1fd">Cy_GPIO_SetDrivemode</a>(GPIO_PRT1, 0UL, <a class="code" href="group__group__gpio__drive_modes.html#gabb81a7da2a4cd1ed6501515f9b6950e8">CY_GPIO_DM_ANALOG</a>);</div><div class="line">    <a class="code" href="group__group__gpio__functions__gpio.html#ga97e64dc8c45e7cd73e3012100d03b1fd">Cy_GPIO_SetDrivemode</a>(GPIO_PRT1, 1UL, <a class="code" href="group__group__gpio__drive_modes.html#gabb81a7da2a4cd1ed6501515f9b6950e8">CY_GPIO_DM_ANALOG</a>);</div></div><!-- fragment --><p> To connect SARMUX to any other non-dedicated port, you may need to close additional HSIOM switches to route signals through AMUXBUS. For more detail, see the device TRM, AMUX splitting.</p>
<p>The following code snippet is an alternative pin configuration. To connect Port 1 to AMUXBUS, close the left and right switches of AMUX_SPLIT_CTL[1] and AMUX_SPLIT_CTL[6].</p>
<h1><a class="anchor" id="group_sar_low_power"></a>
Low Power Support</h1>
<p>This SAR driver provides a callback function to handle power mode transitions. The <a class="el" href="group__group__sar__functions__power.html#ga46e3b5906aad114fb19f15f3ebbc8de2">Cy_SAR_DeepSleepCallback</a> function ensures that SAR conversions are stopped before Deep Sleep entry. Upon wakeup, the callback enables the hardware and continuous conversions, if previously enabled.</p>
<p>To trigger the callback execution, the callback must be registered before calling <a class="el" href="group__group__syspm__functions__power.html#gae24d1a7d457b5355858651a213c2f4cd">Cy_SysPm_CpuEnterDeepSleep</a>. Refer to <a class="el" href="group__group__syspm.html">SysPm (System Power Management)</a> driver for more information about power mode transitions and callback registration.</p>
<p>Recall that during configuration the SARMUX can be configured to remain enabled in Deep Sleep mode by the <a class="el" href="structcy__stc__sar__config__t.html#a5ca8135ec8aacb938614f19aa47984b9">cy_stc_sar_config_t::sarMuxDsEn</a> setting. All other blocks (SARADC, REFBUF, and SARSEQ) do not support Deep Sleep mode operation.</p>
<h1><a class="anchor" id="group_sar_more_information"></a>
More Information</h1>
<p>For more information on the SAR ADC subsystem, refer to the technical reference manual (TRM).</p>
<h1><a class="anchor" id="group_sar_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th><p class="starttd">Reason for Change</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__sar__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sar__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__sar__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sar__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__sar__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sar__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__sar__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sar__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
